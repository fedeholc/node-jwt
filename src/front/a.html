<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <h1>hola</h1>
  <p> Enter new password: </p>
  <input type="password" id="password" placeholder="password" required>
  <p> Confirm new password: </p>
  <input type="password" id="confirm-password" placeholder="password" required>
  <button id="btn-change-password">Change Password</button>
</body>
<script>
  // Obtener los parámetros de la URL
  const params = new URLSearchParams(window.location.search);

  // Extraer el token
  const token = params.get('token');

  console.log(token); // Aquí verás el valor del token

  //TODO: y si mejor le enviamos un codigo al usuario y que lo ingrese
  //en la misma página para no tener que abrir otra?

  let btnChangePassword = document.getElementById('btn-change-password');

  btnChangePassword.addEventListener('click', async () => {
    const pass = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm-password').value;

    if (pass !== confirmPassword) {
      alert('Passwords do not match');
      return;
    }
    //TODO: deshardcodear la url
    const response = await fetch('http://127.0.0.1:1234/change-password', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        token,
        pass,
      }),
    });

    const data = await response.json();

    if (data.error) {
      alert(data.error);
      return;
    }

    alert('Password changed successfully');
    window.location.href = 'http://127.0.0.1:8080/';
  });

</script>

</html>